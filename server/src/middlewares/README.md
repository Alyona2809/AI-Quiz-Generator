# Middleware для AI Quiz Generator

Этот каталог содержит middleware для обработки запросов генерации квизов.

## Структура middleware

### 1. `fileUpload.js`

- **Назначение**: Конфигурация multer для загрузки файлов
- **Функция**: `uploadSingleFile` - middleware для загрузки одного файла в память
- **Использование**: Первый middleware в цепочке для обработки multipart/form-data

### 2. `validateQuizInput.js`

- **Назначение**: Валидация входных данных
- **Проверки**:
  - Наличие либо файла, либо текста
  - Непустой текст (если передан)
- **Использование**: Второй middleware в цепочке

### 3. `processPdfFile.js`

- **Назначение**: Обработка PDF файлов
- **Функции**:
  - Извлечение текста из PDF с помощью pdf-parse
  - Сохранение текста в `req.extractedText`
  - Валидация извлеченного текста
- **Использование**: Третий middleware в цепочке

### 4. `openaiService.js`

- **Назначение**: Работа с OpenAI API
- **Функции**:
  - Создание промпта для генерации квиза
  - Вызов OpenAI API
  - Парсинг и валидация ответа
  - Сохранение данных квиза в `req.quizData`
- **Использование**: Четвертый middleware в цепочке

### 5. `removeHttpHeader.js` (существующий)

- **Назначение**: Удаление HTTP заголовков
- **Функция**: `removeHttpHeader(headerName)` - удаляет указанный заголовок

## Цепочка middleware для генерации квиза

```
POST /api/quiz/generate-quiz
├── uploadSingleFile          # Загрузка файла
├── validateQuizInput         # Валидация входных данных
├── processPdfFile           # Обработка PDF (если есть)
├── generateQuizWithOpenAI   # Генерация квиза через OpenAI
└── generateQuiz             # Отправка результата
```

## Преимущества разделения на middleware

1. **Разделение ответственности**: Каждый middleware отвечает за одну задачу
2. **Переиспользование**: Middleware можно использовать в других роутах
3. **Тестируемость**: Каждый middleware можно тестировать отдельно
4. **Читаемость**: Код становится более понятным и структурированным
5. **Обработка ошибок**: Централизованная обработка ошибок в каждом middleware
